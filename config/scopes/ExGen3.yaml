# Scarlet & Violet ex - Single Card per Pokemon
#
# Fetches Scarlet & Violet ex cards from TCGdex API (2023+)
# and transforms them to variant format with ONE card per Pokemon.
#
# Pipeline Architecture:
# - fetch → writes raw data to output_file (data/source/)
# - transform → reads source_file, writes variant to output_file
# - enrich steps → work with context only
# - save_output → writes final file
#
# Priority when multiple cards exist:
# 1. SV - Base Set (first SV ex set)
# 2. Alphabetically by set name
#
# Expected output:
# - Source: data/source/tcg_sv_ex.json (366 cards)
# - Target: data/ExGen3.json (~130 Pokemon)

scope: ExGen3
description: "Scarlet & Violet ex series from TCGdex API - one card per Pokemon"

pipeline:
  # Load metadata
  - step: enrich_metadata
    params:
      metadata_file: enrichments/metadata.json
  
  # Step 1: Validate that Pokedex exists (required for name translations)
  - step: validate_pokedex_exists
    params:
      pokedex_file: data/Pokedex.json

  # Step 2: Fetch SV ex cards from TCGdex API
  - step: fetch_tcgdex_ex_gen3
    params:
      language: en
      output_file: data/source/tcg_sv_ex.json

  # Step 3: Transform to single card per Pokemon
  - step: transform_ex_gen3
    params:
      source_file: data/source/tcg_sv_ex.json
      output_file: data/ExGen3.json

  # Step 4: Enrich with multilingual Pokemon names from Pokedex (context-only)
  - step: enrich_names_from_pokedex
    params:
      pokedex_file: data/Pokedex.json

  # Step 5: Add featured Pokemon (context-only)
  - step: enrich_featured_pokemon
    params:
      featured_file: enrichments/featured_pokemon.json
      mode: variant
      variant_name: ExGen3

  # Step 6: Add section descriptions from variant_descriptions.json (context-only)
  - step: enrich_section_descriptions
    params:
      mode: variant
      variant_name: ExGen3
      descriptions_file: enrichments/variant_descriptions.json
  
  # Step 7: Save final output
  - step: save_output
    params:
      output_file: data/ExGen3.json
  
  # Step 8: Cache images
  - step: cache_pokemon_images
    params:
      skip_existing: true

target_file: data/ExGen3.json
